# Agents Inc. CLI - Completed Tasks

> Completed tasks from [TODO.md](./TODO.md) are archived here to keep the main file lean.

- **D-16**: Populate config defaults on `init` -- Added commented-out `source`, `marketplace`, and `agents_source` options to generated config.yaml.
- **R-1**: Consolidate agent-skill mappings into YAML -- Demoted `SKILL_TO_AGENTS` and `AGENT_SKILL_PREFIXES` to private fallbacks; YAML is now the primary source via `getCachedDefaults()`. Tests updated to verify YAML-loaded values.
- **U-STACK-DESC**: Shorten default stack descriptions -- All stack descriptions in `config/stacks.yaml` shortened to 3-5 words.
- **U-SOURCES-SEARCH-FOCUS**: Auto-focus search field in sources step -- Used Ink `isActive` on `useInput` to properly route keyboard input to search modal when open, deactivating grid input.
- **Wizard-UX #2**: Marketplace label always renders -- Label now always shows in wizard header, defaulting to "agents-inc (public)" when no custom marketplace is configured.
- **B-1**: Fix `preloaded` dropped from stack skills -- Overlay preloaded flags from `buildStackProperty(loadedStack)` onto config in `buildLocalConfig()` after `generateProjectConfigFromSkills` call.
- **#9**: Divide hackathon tasks among team -- Planned and organized task distribution for the hackathon with parallel workstreams.
- **#10**: Create work-level marketplace repo -- Coordinated with team to create the marketplace repository.
- **U-UNINSTALL-SCOPE**: Uninstall removes only CLI-owned files -- Added `generatedByAgentsInc` flag to metadata during install/eject; uninstall now surgically removes only CLI-created skills and agents.
- **U-EXPERT-MODE-PERSIST**: Persist expertMode to config YAML -- Added `expertMode` field to ProjectConfig, schemas, local-installer, wizard props (7 files, follows installMode pattern).
- **U-METADATA-REQUIRED**: Require metadata.yaml for all custom skills -- Updated compile's `loadSkillsFromDir()` to require metadata.yaml; emits `warn()` when missing.
- **Wizard-UX session**: Remove branding from tab bar, suppress marketplace.json warning, replace fixed `AVG_TAG_WIDTH` with actual calculation, remove state icons from tags, dim default borders with state-colored on hover, stable skill ordering, hotkey badge highlights teal when active, domain selection spacebar/ESC, legend filled circle for active, build step max height + natural scroll.
- **T5**: Create work-related agents and skills -- Identified gaps, created specialized agents and skills for work patterns.
- **U-SOURCES-SCROLL**: Add scrolling to Sources step -- Replicated Build step's pixel-accurate scroll pattern in SourceGrid with `useMeasuredHeight` hook and retry measurement strategy [0, 16, 50ms].
- **UX-14**: Build step compatibility labels toggle -- Replaced "descriptions" toggle with compatibility labels toggle showing "(Selected)", "(Recommended)", "(Discouraged)", "(Disabled)" on skill tags via `d` key.
- **D-30**: Add Agents selection step to wizard -- Added new "Agents" wizard step with grouped checkbox layout. Agents pre-selected based on selected domains using `agentSkillPrefixes` from agent-mappings.yaml.
- **D-35**: Pre-D-31 cleanup: merge meta-framework + remove web-extras -- Merged `meta-framework` into `framework`, removed `web-extras` domain/parentDomain plumbing, simplified agent preselection logic.
- **D-27**: Switch config/metadata fields from snake_case to camelCase -- Renamed all 27 snake_case fields to camelCase across YAML configs, TypeScript types, Zod schemas, JSON schemas, and all property accesses.
- **D-29**: Ensure skills metadata YAML includes $schema reference -- All 87 metadata.yaml files in the source marketplace now include `$schema` references.
- **D-31**: Prefix categories with their domain -- Subcategory keys now use domain-prefixed format (e.g., `web-framework`, `api-testing`) across skills matrix, stacks, metadata, schemas, and TypeScript types.
- **D-32**: Add category as enum in metadata JSON schema -- Changed `metadataValidationSchema` category field from `z.string()` to `subcategorySchema`, regenerated `metadata.schema.json` with 37-value enum.
- **D-38**: Remove `version` command group -- Deleted version commands (show, bump, set), core logic (`plugin-version.ts`), and all tests. Redundant with build plugins auto-versioning.
- **D-39**: Remove `version` integer field from metadata.yaml schema -- Removed from schemas, types, loaders, UI, and test fixtures. Was parsed but silently dropped; actual versioning lives in plugin.json.
- **B-01**: Edit wizard shows steps that were omitted during init -- Domains persisted to config during init; edit mode restores `initialDomains` to wizard, filtering build steps to only selected domains.
- **B-02**: Validate compatibleWith/conflictsWith refs in metadata -- Post-merge validation pass checks every `compatibleWith` and `conflictsWith` entry; emits `warn()` for unresolvable references.
- **B-04**: Disabled-selected skills need distinct visual state -- Skills that are both disabled AND selected now show a distinct dimmed teal visual state.
- **B-06**: --refresh leaves orphan skills from stale cache -- Source cache directory is now deleted before fetching when `--refresh` is used, preventing orphan skills from stale cache.
- **D-36**: Eject: check specific agent dirs, not just agents/ -- `eject agent-partials` now checks for specific agent partial subdirectories rather than just the parent `agents/` folder.
- **D-43**: Eject templates as its own type, not a flag -- `templates` is now a first-class eject type (`agentsinc eject templates`) instead of a `--templates` flag on `agent-partials`. Updated EJECT_TYPES, switch cases, examples, and tests.
- **B-05**: Edit mode restores sub-agent selection -- `selectedAgents` persisted to ProjectConfig during init/compile and restored in edit mode. Commit c66c7a3, release 0.45.0.
- **B-03**: Init applies same compatibility filtering as edit -- Both init and edit use the shared Wizard/StepBuild/useFrameworkFiltering path, which applies `isCompatibleWithSelectedFrameworks` filtering identically.
- **D-43**: Remove `getAgentsForSkill` / `skillToAgents` / `agentSkillPrefixes` -- Deleted `agent-mappings.yaml`, `defaults-loader.ts` + test, removed `getAgentsForSkill`/`getEffectiveSkillToAgents`/`DEFAULT_AGENTS` from `config-generator.ts`, removed related schema fields. All selected skills now assigned to all selected agents; stacks remain the mechanism for fine-grained mapping.
- **D-42**: `agentsinc validate --source` command -- Added source validation to existing `validate` command via `--source` flag. Created `source-validator.ts` module validating metadata schemas, missing files, snake_case keys, displayName/directory consistency, category patterns, and cross-references. 14 new tests.
- **D-45**: Verify `contentHash` in marketplace/plugin build commands -- Added `verifyContentHash()` to `skill-plugin-compiler.ts` with `verifyHash` option. Build pipeline now validates contentHash is present, correctly formatted, and matches computed hash. `new:skill` writes contentHash automatically. 10 new tests.
- **D-48**: Revert `(string & {})` type widening -- Already resolved by D-46 implementation which used runtime schema extensibility (`customExtensions` Sets + `extensible*Schema` validators) instead of type widening. Types remain strict closed unions.
- **D-49**: Add `domain` field to skill `metadata.yaml` and agent `metadata.yaml` -- Optional `domain?: Domain` added to `SkillMetadataConfig`, `AgentYamlConfig`, `AgentDefinition`, and `ExtractedSkillMetadata`. Threaded through schemas, loaders, and wizard agent grouping. Agent step uses explicit domain before kebab-prefix inference.
- **D-51**: Remove legacy slash-in-skill-ID code -- Removed 4 dead code paths: `plugin-finder.ts` slash split, `skill-fetcher.ts` slash branch, `compiler.ts` slash replace, `create-test-source.ts` slash replace. 2 slash-branch tests removed.
- **D-53**: Build step "X of N" counter for exclusive categories -- Added dimmed selection counter to `CategorySection` in `category-grid.tsx`: "(X of 1)" for exclusive, "(X selected)" for non-exclusive. Hidden in expert mode. 6 new tests.
- **D-54**: Fix domain ordering in build step -- `BUILT_IN_DOMAIN_ORDER` consolidated to `consts.ts` with canonical order Web > API > Mobile > CLI. `orderDomains()` utility added to `utils.ts`. Build step tabs now sorted before rendering. 2 new tests.
- **D-55**: Domain deselection removes skills -- `toggleDomain` in `wizard-store.ts` now clears `domainSelections[domain]` when toggling OFF via computed property destructuring. Confirm step count reflects only selected domains. 4 new tests.
- **T-07**: Replace real skills repo in source-loader.test.ts with fixtures -- Already completed during D-46 commits. All 24 tests use `createTestSource()` fixtures exclusively.
- **T-09**: Extract shared base skill/category/matrix fixtures -- Added 6 methodology skills and 4 categories (styling, api, database, methodology) to `TEST_SKILLS`/`TEST_CATEGORIES` in `test-fixtures.ts`. Replaced inline duplicates across 4 test files. Net -57 lines.
- **U13**: Run Documentor Agent on CLI Codebase -- Generated `.ai-docs/` directory with DOCUMENTATION_MAP.md, architecture-overview.md, commands.md, component-patterns.md, store-map.md, test-infrastructure.md, type-system.md, utilities.md, and 5 feature docs (compilation-pipeline, configuration, plugin-system, skills-and-matrix, wizard-flow).
- **H18**: Tailor documentation-bible to CLI repo -- Phases 1-3 complete. documentation-bible.md and documentor workflow.md tailored to CLI patterns (Zustand, Ink, Vitest, factory-based test data). Documentor agent generated .ai-docs/.
- **D-55**: Clean up dead code: remove `escapedSkillId` regex and `(@author)` stripping in `skill-fetcher.ts` -- Removed ~14 lines of dead code. Skill IDs are kebab-case only, no legacy slash or author suffix handling needed.
- **D-56**: Rename `agentDomains` → `agentDefinedDomains` -- Updated field name on `MergedSkillsMatrix`, JSDoc comments changed from "overrides inference" to "takes precedence over inference". 4 files changed.
- **D-57**: Fix `TEST_SKILLS.antiOverEngineering`: remove unnecessary inline `path` override in config-generator test -- Removed the inline `path` override that was never asserted on.
- **D-58**: `orderDomains`: put custom domains first, then built-in domains -- Swapped ordering in `orderDomains()` so custom marketplace domains appear before built-in domains in the wizard.
- **T-08**: Audit all test files: extract fixtures, use real IDs -- Created `__tests__/mock-data/` with 7 shared constant files (stacks, agents, skills, categories, matrices, sources, index). Updated 17 test files to import from mock-data/ and use factories. Zero inline `SkillsMatrixConfig`/`MergedSkillsMatrix` construction remaining. 2561 tests passing, 0 type errors.
- **D-34**: Replace agent-mappings.yaml with schema-backed file -- Moot. D-43 removed `agent-mappings.yaml`, `getAgentsForSkill()`, `skillToAgents`, and `agentSkillPrefixes` entirely. All skills are now assigned to all selected agents; stacks provide fine-grained mapping.
- **D-30**: Update schemas when generating new categories/domains -- Moot. D-46 Phase 2 handles this at runtime via `discoverAndExtendFromSource()` with dynamic Zod schema extension. Matrix decomposition Phase 6 generates config files from `new skill` command.
- **D-33**: README: frame Agents Inc as an agent composition framework -- Rewrote README: two-part framing (marketplace + CLI), lifecycle-focused How It Works, subagent terminology throughout, progressive customization layers, template vs partial distinction, tech stack section.
- **D-53b**: Rename `agent.yaml` to `metadata.yaml` across all agents -- Renamed all 17 `agent.yaml` files to `metadata.yaml`. Updated `STANDARD_FILES.AGENT_YAML` → `STANDARD_FILES.AGENT_METADATA_YAML` in consts.ts, all loaders, schemas (`agentYamlConfigSchema`), JSON schemas, generate-json-schemas script, compiler, test fixtures, and E2E helpers. ~52 files changed.
- **D-60**: Remove `cli-migrator` subagent -- Deleted entire `src/agents/migration/cli-migrator/` directory (7 files: agent.yaml, intro.md, workflow.md, critical-requirements.md, critical-reminders.md, output-format.md, anti-patterns.md, conversion-mappings.md). Removed `cli-migrator` from `AgentName` union (17 members now), `agentNameSchema` Zod enum, `DOMAIN_AGENTS.cli`, README table, stacks.yaml, and all documentation. Migration category removed.
- **D-54b**: Remove expert mode -- Removed `expertMode` field from `ProjectConfig`, `WizardResultV2`, `WizardProps`, wizard store state and actions (`toggleExpertMode`), `step-settings.tsx` toggle, `step-build.tsx` filtering, `config.yaml` persistence, and `help-modal.tsx` references. All skills now visible by default (previously expert-only skills are standard). Removed `disabled` OptionState and `isCategoryAllDisabled()` from matrix-resolver.
- **D-44b**: Document `eject templates` as a first-class eject type -- Updated `docs/reference/commands.md` with eject types table, `.ai-docs/commands.md`, `TODO-testing.md` test plan, and all references from `--templates` flag to `agentsinc eject templates`. Previously completed as D-43 code change; this is the documentation follow-up.
- **D-59**: Unified scrolling across all wizard views -- Created `use-section-scroll.ts` hook with `useSectionScroll()` for variable-height section scrolling and `computeRowScrollTop()` pure function for uniform-row scrolling. Adopted by `category-grid.tsx`, `source-grid.tsx`, `stack-selection.tsx`. Unit tests added.
