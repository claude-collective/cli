# Release 0.38.0 (2026-02-18)

## Added

- **Agents selection step** in wizard (between Sources and Confirm) — users can now see and toggle which agents will be compiled
- Agents are preselected based on actually selected skills, not just domains — selecting only web skills no longer preselects API agents
- Reusable `CheckboxGrid` component extracted from domain selection for use across wizard steps
- Agent count shown in the Confirm step summary
- Stacks schema now enforces valid subcategory keys via `propertyNames` enum (37 values) — typos in stacks.yaml are caught by IDE and at runtime
- `stackSubcategorySchema` for stacks-only keys (`base-framework`, `platform`) that extend matrix subcategories
- Post-processor in JSON schema generator for injecting `propertyNames` constraints

## Changed

- `preselectAgentsFromDomains` replaced by `preselectAgentsFromSkills` — preselection derives domain prefixes from skill IDs instead of wizard domain selections
- Removed `CROSS_CUTTING_AGENTS` and `DOMAIN_TO_PREFIX` — no longer needed with skill-based preselection
- `config-generator.ts` uses `selectedAgents` from wizard result when provided, falls back to derived agents
- `WizardResultV2` now includes `selectedAgents: AgentName[]`
- Wizard step sequence is now: Stack → Build → Sources → Agents → Confirm (was 4 steps, now 5)
- `typedEntries<AgentName, string[]>()` used instead of bare call + manual cast

## Fixed

- Agents were preselected for domains where no skills were chosen (e.g., selecting "web" + "api" domains but only web skills would preselect both web and api agents)
- `web-pm` and `web-architecture` were incorrectly treated as cross-cutting (always preselected) — they are web-domain agents
- `web/state` → `web/client-state` in project-config round-trip test (invalid subcategory)
